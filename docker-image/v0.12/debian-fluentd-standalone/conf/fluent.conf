
# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY, USE /templates/conf/fluent.conf.erb

@include systemd.conf
@include kubernetes.conf

#<match **>
#  @type secure_forward
#  shared_key SecuredGraylogODataTransfer
#  self_hostname ${hostname}
#  secure no
##  enable_strict_verification no
#  <server>
##    host 10.6.224.247
##    host 10.6.225.100
#    host logs.default
#    port 24284
#  </server>
#</match>

<filter **>                               
  @type concat                            
  key log                                 
  multiline_start_regexp /^\[(op|oz)_(worker|panel)\] (\[\w )?\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d{3}/                                                                 
  flush_interval 5                        
  timeout_label @NORMAL                   
</filter>

#<match kubernetes.**>
#  @type relabel
#  @label @NORMAL
#  @type rewrite_tag_filter
#  rewriterule1 log \@changes\_worker od.datastore.${tag}
#  rewriterule2 log CRASH\sREPORT od.erlang.${tag}
#  rewriterule3 log Supervisor\scouchbeam od.datastore.${tag}
#  rewriterule4 log gen\_server od.erlang.${tag}
#  rewriterule5 log monitoring od.monitoring.${tag}
#  rewriterule6 log DBSync od.dbsync.${tag}
#  rewriterule7 log .+ od.untagged.${tag}
#</match>

<label @NORMAL>
##<match od.*>
#<filter od.**>
#  @type record_transformer
##  enable_ruby true
#  <record>
#    od_service ${tag_parts[1]}
#  </record>
#</filter>

<match kubernetes.**> #od.** kubernetes.**>
  @type copy
  <store>
#    @type elasticsearch
#    host elasticsearch
#    port 9200
#    logstash_format true
#    logstash_prefix fluentd
#    logstash_dateformat %Y%m%d
#    include_tag_key true
#    type_name access_log
#    tag_key @log_name
#    flush_interval 1s
    type elasticsearch
    log_level info
    include_tag_key true
    host elasticsearch #"#{ENV['FLUENT_ELASTICSEARCH_HOST']}"
    port 9200 #"#{ENV['FLUENT_ELASTICSEARCH_PORT']}"
    scheme http #"#{ENV['FLUENT_ELASTICSEARCH_SCHEME'] || 'http'}"
    #user "#{ENV['FLUENT_ELASTICSEARCH_USER']}"
    #password "#{ENV['FLUENT_ELASTICSEARCH_PASSWORD']}"
    reload_connections true #"#{ENV['FLUENT_ELASTICSEARCH_RELOAD_CONNECTIONS'] || 'true'}"
    logstash_prefix logstash #"#{ENV['FLUENT_ELASTICSEARCH_LOGSTASH_PREFIX'] || 'logstash'}"
    logstash_format true
    buffer_chunk_limit 2M
    buffer_queue_limit 32
    flush_interval 5s
    max_retry_wait 30
    disable_retry_limit
    num_threads 8
  </store>
  <store>
    @type stdout
  </store>
</match>
</label>
